<!-- frontend/index.html -->
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Waste Segregation Heatmap</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>html,body,#map{height:100%;margin:0;padding:0}</style>
</head>
<body>
<div id="map"></div>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
<script>
async function loadCSV() {
  const r = await fetch('/csv');
  if (!r.ok) {
    console.error("CSV fetch failed", r.status);
    return [];
  }
  const text = await r.text();
  const lines = text.split('\n').slice(1);
  const heat = [];
  for (const ln of lines) {
    if (!ln.trim()) continue;
    const cols = ln.split(',');
    const lat = parseFloat(cols[1]), lon = parseFloat(cols[2]);
    const waste = (cols[8] || "").toLowerCase();
    let w = 1;
    if (waste.includes('hazard')) w = 3;
    else if (waste.includes('wet')) w = 2;
    if (isFinite(lat) && isFinite(lon)) heat.push([lat, lon, w]);
  }
  return heat;
}

(async ()=>{
  const heatData = await loadCSV();
  const map = L.map('map').setView([22.5726,88.3639], 13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
  L.heatLayer(heatData, {radius: 25}).addTo(map);
})();
</script>
</body>
</html>
